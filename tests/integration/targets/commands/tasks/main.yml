# 0: clean existing
- import_tasks:
    file: 0_clean_existing.yml

# config
- name: Add two vms to the Vagrantfile
  jclaveau.vagrant.config:
  args:
    state: "present"
    name: "{{ item }}"
    config:
      box: debian/buster64
      # box: boxomatic/alpine-3.13
      # box: generic/alpine38
      cpus: 4
      forwarded_ports:
        - host: "808{{ i }}"
          guest: 80
        - host: "8{{ i }}43"
          guest: 443
      shell:
        inline: hostname
        # run: "always"
    # log: true
  register: vagrant_config_results
  loop:
    - "srv001"
    - "srv002"
  loop_control:
    index_var: "i"
  tags:
    - always

# 1: up
- import_tasks:
    file: 1_up_test.yml

# 2: status
- include_tasks:
    file: 2_status_test.yml
    apply:
      tags:
        - status
  tags:
    - status

# 3: port
- include_tasks:
    file: 3_port_test.yml
    apply:
      tags:
        - port
  tags:
    - port

# 4: ssh-config
- include_tasks:
    file: 4_ssh_config_test.yml
    apply:
      tags:
        - ssh_config
  tags:
    - ssh_config

# 4.1: ssh
- import_tasks:
    file: 4.1_ssh_test.yml

# 4.2: reload
- import_tasks:
    file: 4.2_reload_test.yml

# 5: suspend
- include_tasks:
    file: 5_suspend_test.yml
    apply:
      tags:
        - suspend
  tags:
    - suspend

# 6: resume
- include_tasks:
    file: 6_resume_test.yml
    apply:
      tags:
        - resume
  tags:
    - resume

# 7: halt
- include_tasks:
    file: 7_halt_test.yml
    apply:
      tags:
        - halt
  tags:
    - halt

# 8: destroy
- include_tasks:
    file: 8_destroy_test.yml
    apply:
      tags:
        - destroy
  tags:
    - destroy

# deinit
# test up
