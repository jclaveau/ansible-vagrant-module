---
# 0: clean existing
- include_tasks:
    file: 0_clean_existing.yml
    apply:
      tags:
        - clean_existing
  tags:
    - clean_existing

# config
- name: Add two vms to the Vagrantfile
  jclaveau.vagrant.config:
  args:
    state: "present"
    name: "{{ item }}"
    config:
      box: debian/buster64
      # box: boxomatic/alpine-3.13
      # box: generic/alpine38
      cpus: 4
      forwarded_ports:
        - host: "808{{ i }}"
          guest: 80
        - host: "8{{ i }}43"
          guest: 443
    # log: true
  register: vagrant_config_results
  loop:
    - "srv001"
    - "srv002"
  loop_control:
    index_var: "i"

# 1: up
- include_tasks:
    file: 1_up_test.yml
    apply:
      tags:
        - up
  tags:
    # - always
    - up

# 2: status
- include_tasks:
    file: 2_status_test.yml
    apply:
      tags:
        - status
  tags:
    - status

# 3: port
- include_tasks:
    file: 3_port_test.yml
    apply:
      tags:
        - port
  tags:
    - port

# 4: ssh-config
- include_tasks:
    file: 4_ssh_config_test.yml
    apply:
      tags:
        - ssh
  tags:
    - ssh

# 5: suspend
- include_tasks:
    file: 5_suspend_test.yml
    apply:
      tags:
        - suspend
  tags:
    - suspend

# 6: resume
- include_tasks:
    file: 6_resume_test.yml
    apply:
      tags:
        - resume
  tags:
    - resume

- name: stop
  ansible.builtin.fail:

# halt
# destroy
# clean config
